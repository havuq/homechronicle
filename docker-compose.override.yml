# docker-compose.override.yml — local development overrides (macOS / Docker Desktop)
#
# Docker Desktop on macOS does NOT support network_mode: host — the container
# cannot reach the host LAN, so mDNS HomeKit discovery won't work locally.
# This override switches the listener to bridge networking and seeds the DB
# with fake events so you can develop and test the UI without a real NAS.
#
# This file is automatically merged by `docker compose up` when present.
# It is NOT used on the NAS (where only docker-compose.yml is used).
# Add docker-compose.override.yml to .gitignore if you don't want it committed,
# or keep it committed as the standard local-dev config.

services:
  listener:
    # Override: use bridge network instead of host (host mode doesn't work on macOS)
    network_mode: ""
    networks:
      - internal
    ports:
      - "3001:3001"
    environment:
      # Listener reaches postgres via Docker DNS (service name), not 127.0.0.1
      DATABASE_URL: postgresql://${POSTGRES_USER:-homekit}:${POSTGRES_PASSWORD:-changeme}@postgres:5432/${POSTGRES_DB:-homekit_events}
      API_PORT: ${API_PORT:-3001}
      NODE_ENV: development

  web:
    environment:
      # In bridge mode, nginx proxies /api to the listener service by name
      - LISTENER_HOST=listener
