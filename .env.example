# Copy to .env and fill in your values:
#   cp .env.example .env

# ── Deployment / Compose ──────────────────────────────────────────────────────
TZ=UTC
POSTGRES_IMAGE=postgres:16-alpine
LISTENER_IMAGE=ghcr.io/havuq/homechronicle/listener:latest
WEB_IMAGE=ghcr.io/havuq/homechronicle/web:latest
WEB_PORT=3000
POSTGRES_PORT=5432
# Recommended on Linux/NAS hosts for HomeKit mDNS support.
LISTENER_NETWORK_MODE=host
# When listener uses host networking:
# - default: host.docker.internal
# - Portainer/Swarm fallback: use the NAS/Raspberry Pi LAN IP (e.g. 192.168.1.50)
LISTENER_HOST=host.docker.internal

# ── PostgreSQL ────────────────────────────────────────────────────────────────
POSTGRES_USER=homekit
POSTGRES_PASSWORD=changeme
POSTGRES_DB=homekit_events
# Optional explicit DB URL. Leave empty to auto-build from vars above.
DATABASE_URL=

# ── Listener / API ────────────────────────────────────────────────────────────
# Port the REST API listens on (also used by the web container to proxy requests)
API_PORT=3001
NODE_ENV=production
# Optional write auth token. When set, listener requires this token for
# POST/PATCH/DELETE requests (via X-API-Token or Authorization: Bearer ...).
API_TOKEN=

# Delay (ms) before logging OFF for switches named like "run leveling" / "run clean cycle".
# Helps treat instant auto-reset switches as "cycle complete" signals.
RUN_CYCLE_OFF_DELAY_MS=900000
# Alerts are deferred for now; keep disabled by default.
ALERTS_ENABLED=false
# Webhook timeout (ms) for alert deliveries.
ALERTS_WEBHOOK_TIMEOUT_MS=5000

# Background refresh for pairings/rooms cache loaded from JSON files.
STORE_REFRESH_INTERVAL_MS=30000

# ── Matter runtime (optional) ────────────────────────────────────────────────
# Command used to commission a Matter node. It is rendered by replacing:
#   {nodeId} {setupCode} {address} {port} {transport} {method}
# Example:
# MATTER_COMMISSION_CMD=chip-tool pairing code {nodeId} {setupCode} {address} {port}
MATTER_COMMISSION_CMD=

# Command used to poll node state and emit JSON to stdout.
# Expected output: either JSON array, {"events":[...]}, or JSON lines.
# Each event should include:
#   endpointId, clusterId, attributeId, characteristic (or cluster+attribute), value/newValue
# Variables available:
#   {nodeId} {name} {address} {port} {transport}
MATTER_POLL_CMD=

# Poll interval and command timeout for Matter runtime.
MATTER_POLL_INTERVAL_MS=30000
MATTER_COMMAND_TIMEOUT_MS=20000

# Retention policy for event_logs.
# Old rows are moved to event_logs_archive then deleted (if RETENTION_ARCHIVE=true).
RETENTION_DAYS=365
RETENTION_SWEEP_MS=86400000
RETENTION_ARCHIVE=true
